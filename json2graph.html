<!DOCTYPE html>
<html>
<head>
  <title>Speed Test Graph</title>

  <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="http://getbootstrap.com/examples/justified-nav/justified-nav.css" rel="stylesheet">

  <style>
    textarea {
      width: 100%;
    }
    span {
      display: block;
      font-size: .7em;
      color: grey;
    }
    .download{
      color: darkgreen;
      font-weight: bold;
    }
    .upload{
      color: blue;
      font-weight: bold;
    }
    .axis path {
      fill: none;
      stroke: #777;
      shape-rendering: crispEdges;
    }

    .axis text {
      font-family: Lato;
      font-size: 13px;
    }
  </style>
</head>
<body>

<div class="container">

  <div class="row">
    <div class="col-md-6">
      <h3>JSON Input</h3>
      <textarea id="textarea-data"></textarea>
      <button class="btn btn-primary" id="btn-generate">Generate</button>
    </div>
    <div class="col-md-6">
      <h3>Instructions</h3>
      <p>Please use Chrome browser.</p>
      <p>Copy and paste the JSON data into the JSON Input box and click on generate.</p>
      <p>JSON Format: <span>[{"date":"2016-06-07 20:00:36","download":0.43,"upload":0.234,"ping":140.2}]</span></p>
      <p>Legend: <span class="download">Download</span><span class="upload">Upload</span></p>
    </div>
  </div>

  <div class="jumbotron">
    <svg id="visualisation" width="1000" height="500"></svg>
  </div>

</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script>

  jQuery('#btn-generate').on('click', function () {
    var data = jQuery('#textarea-data').val();
    try {
      data = JSON.parse(data);
    }catch(e){
      alert('JSON is not properly formatted');
    }

    var vis = d3.select("#visualisation"),
      WIDTH = 1000,
      HEIGHT = 500,
      MARGINS = {
        top: 20,
        right: 20,
        bottom: 20,
        left: 50
      },

      xScale = d3.time.scale().range([MARGINS.left, WIDTH - MARGINS.right]).domain([new Date(data[0].date), new Date(data[data.length - 1].date)]),
      yScale = d3.scale.linear().range([HEIGHT - MARGINS.top, MARGINS.bottom]).domain([0, 2]),
      xAxis = d3.svg.axis().scale(xScale).tickFormat(d3.time.format('%e %b %H:%M')),
      yAxis = d3.svg.axis().scale(yScale).orient("left");

    var lineGenDownload = d3.svg.line()
      .x(function (d) {
        return xScale(new Date(d.date));
      })
      .y(function (d) {
        return yScale(d.download);
      })
      .interpolate("basis");

    var lineGenUpload = d3.svg.line()
      .x(function (d) {
        return xScale(new Date(d.date));
      })
      .y(function (d) {
        return yScale(d.upload);
      })
      .interpolate("basis");

    vis.append("svg:g")
      .attr("class", "axis")
      .attr("transform", "translate(0," + (HEIGHT - MARGINS.bottom) + ")")
      .call(xAxis);

    vis.append("svg:g")
      .attr("class", "axis")
      .attr("transform", "translate(" + (MARGINS.left) + ",0)")
      .call(yAxis);

    vis.append('svg:path')
      .attr('d', lineGenDownload(data))
      .attr('stroke', 'green')
      .attr('stroke-width', 2)
      .attr('fill', 'none');

    vis.append('svg:path')
      .attr('d', lineGenUpload(data))
      .attr('stroke', 'blue')
      .attr('stroke-width', 2)
      .attr('fill', 'none');

  });
</script>

</body>
</html>